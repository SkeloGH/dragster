!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();t.Gearbox=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._shifting=null,this._shifts={"-1":"R",0:"N",1:"1st",2:"2nd",3:"3rd",4:"4th",5:"5th",6:"6th"},this.total_shifts=t.max_gears,this.shifting_delay=t.shifting_delay,this.current_shift={value:0,name:"N"},this}return i(e,[{key:"getCurrentShift",value:function(){return this.current_shift}},{key:"shiftUp",value:function(){return this._debounceShift(function(){return this.current_shift.value<this.total_shifts&&this.current_shift.value++}),this}},{key:"shiftDown",value:function(){return this._debounceShift(function(){return this.current_shift.value>-1&&this.current_shift.value--}),this}},{key:"_debounceShift",value:function(e){return this._clearState(),this._shifting=setTimeout(function(){e.call(this),this.current_shift.name=this._shifts[this.current_shift.value+""],console.log(this.current_shift)}.bind(this),this.shifting_delay),this}},{key:"_clearState",value:function(){return null!==this._shifting&&(clearTimeout(this._shifting),this._shifting=null),this}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();t.PlayerCar=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sprite=t.sprite,this.max_speed=t.max_speed,this.gearbox=t.gearbox,this.max_speed_rwd=-1400,this.max_accel_rwd=-150,this}return i(e,[{key:"accelerate",value:function(){return this.sprite.body.acceleration.x=this.getAcceleration(),this.sprite.animations.play("left"),this}},{key:"brake",value:function(){var e=this.sprite.body.velocity.x,t=-1*this.sprite.body.velocity.x;return(e>0&&e<90||e<0&&e>-90)&&(t=0,this.sprite.body.velocity.x=0),this.sprite.body.acceleration.x=t,this.sprite.animations.play("right"),this}},{key:"coastNeutral",value:function(){var e=this.sprite.body.velocity.x/this.gearbox.total_shifts;return this.sprite.body.acceleration.x=-1*e,this.sprite.animations.stop(),this}},{key:"getAcceleration",value:function(){var e=0,t=this.sprite.body.velocity.x,r=this.max_speed/this.gearbox.total_shifts,i=this.gearbox.getCurrentShift().value;return i>0&&t<=r*i&&(e=r*i),i<0&&t>=this.max_speed_rwd&&(e=this.max_accel_rwd),e}},{key:"onUpdate",value:function(e,t){return e.up.isDown?this.gearbox.shiftUp():e.down.isDown&&this.gearbox.shiftDown(),e.right.isDown?this.accelerate():e.left.isDown?this.brake():e.right.isDown||e.left.isDown||this.coastNeutral(),"function"==typeof t&&t.call(this),this}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();t.DragStrip=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.states={timer:{start:0,finish:0}},this}return i(e,[{key:"onUpdate",value:function(e){var t=this.config.world.width,r=this.states.timer.start,i=this.states.timer.finish,n=e>=t&&!!r&&!i;(e>0||r>0)&&(e<t&&!r&&!i&&this.timer("start"),n&&this.timer("finish"))}},{key:"timer",value:function(e){var t;if(this.states.timer[e]=Date.now(),"finish"==e)return t=this.states.timer.finish-this.states.timer.start,console.log(t),t}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();t.Utils=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"metersToPx",value:function(e){return 100*e/1}},{key:"kmHrToPxSec",value:function(e){return e*(.28*100)/1}}]),e}()},function(e,t,r){"use strict";var i=r(3),n=r(2),a=r(1),s=r(0);window.game=new function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=null,r={screen_width:window.document.body.scrollWidth,screen_height:window.document.body.scrollHeight,renderer:Phaser.AUTO,element:""},o={main:{car_sprite:"/assets/game/img/cars/phantom/car.png",max_gears:6,max_speed:i.Utils.kmHrToPxSec(150)},enemy:{car_sprite:"/assets/game/img/cars/phantom/car.png",max_gears:6,max_speed:i.Utils.kmHrToPxSec(150)}},u=new n.DragStrip({world:{width:i.Utils.metersToPx(402.34),height:512,background:"/assets/game/img/bg/dragstrip.png"}}),c={player:new a.PlayerCar({gearbox:new s.Gearbox({max_gears:o.main.max_gears,shifting_delay:100}),max_speed:o.main.max_speed}),enemy:new a.PlayerCar({gearbox:new s.Gearbox({max_gears:o.enemy.max_gears,shifting_delay:100}),max_speed:o.enemy.max_speed})},l=new Phaser.Game(r.screen_width,r.screen_height,r.renderer,r.element,{preload:function(){l.load.image("stage__bg",u.config.world.background),l.load.image("player__car",o.main.car_sprite),l.load.image("enemy__car",o.enemy.car_sprite)},create:function(){var e=u.config.world;l.add.tileSprite(0,0,e.width,e.height,"stage__bg"),t=l.input.keyboard.createCursorKeys(),c.player.sprite=l.add.sprite(0,377,"player__car"),c.enemy.sprite=l.add.sprite(0,239,"enemy__car"),l.stage.backgroundColor="#dedede",l.time.advancedTiming=!0,l.world.setBounds(0,0,e.width,e.height),l.physics.arcade.enable(c.player.sprite),l.camera.follow(c.player.sprite)},update:function(){var e=c.player.sprite.body.x;u.onUpdate(e),c.player.onUpdate(t),c.enemy.sprite.position.x=enemy_pos_x,socket&&socket.emit("user.update",{x:e,u:_uid,room:room_name})},render:function(){l.debug.cameraInfo(l.camera,32,32),l.debug.spriteCoords(c.player.sprite,32,500),l.debug.text(l.time.fps||"--",2,14,"#00ff00"),l.debug.text("Players: "+[_uid,enemy_name].join(" "),2,120,"#00ff00"),l.debug.text(c.player.gearbox.current_shift.name,r.screen_width-45,377,"#00ff00")}})}}]);
!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.Gearbox=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._shifting=null,this._shifts={"-1":"R",0:"N",1:"1st",2:"2nd",3:"3rd",4:"4th",5:"5th",6:"6th"},this.total_shifts=t.max_gears,this.shifting_delay=t.shifting_delay,this.current_shift={value:0,name:"N"},this}return r(e,[{key:"getCurrentShift",value:function(){return this.current_shift}},{key:"shiftUp",value:function(){return this._debounceShift(function(){return this.current_shift.value<this.total_shifts&&this.current_shift.value++}),this}},{key:"shiftDown",value:function(){return this._debounceShift(function(){return this.current_shift.value>-1&&this.current_shift.value--}),this}},{key:"_debounceShift",value:function(e){return this._clearState(),this._shifting=setTimeout(function(){e.call(this),this.current_shift.name=this._shifts[this.current_shift.value+""],console.log(this.current_shift)}.bind(this),this.shifting_delay),this}},{key:"_clearState",value:function(){return null!==this._shifting&&(clearTimeout(this._shifting),this._shifting=null),this}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.PlayerCar=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.keys(t).forEach(function(e){return!!t.propertyIsEnumerable(e)&&(this[e]=t[e])}.bind(this)),this.max_speed_rwd=-1400,this.max_accel_rwd=-150,this}return r(e,[{key:"accelerate",value:function(){return this.sprite.body.acceleration.x=this.getAcceleration(),this.sprite.animations.play("left"),this}},{key:"brake",value:function(){var e=this.sprite.body.velocity.x,t=-1*this.sprite.body.velocity.x;return(e>0&&e<90||e<0&&e>-90)&&(t=0,this.sprite.body.velocity.x=0),this.sprite.body.acceleration.x=t,this.sprite.animations.play("right"),this}},{key:"coastNeutral",value:function(){var e=this.sprite.body.velocity.x/this.gearbox.total_shifts;return this.sprite.body.acceleration.x=-1*e,this.sprite.animations.stop(),this}},{key:"getAcceleration",value:function(){var e=0,t=this.sprite.body.velocity.x,i=this.max_speed/this.gearbox.total_shifts,r=this.gearbox.getCurrentShift().value;return r>0&&t<=i*r&&(e=i*r),r<0&&t>=this.max_speed_rwd&&(e=this.max_accel_rwd),e}},{key:"onUpdate",value:function(e,t){return e.up.isDown?this.gearbox.shiftUp():e.down.isDown&&this.gearbox.shiftDown(),e.right.isDown?this.accelerate():e.left.isDown?this.brake():e.right.isDown||e.left.isDown||this.coastNeutral(),"function"==typeof t&&t.call(this),this}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.DragStrip=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.states={timer:{start:0,finish:0}},this}return r(e,[{key:"onUpdate",value:function(e){var t=this.config.world.width,i=this.states.timer.start,r=this.states.timer.finish,n=e>=t&&!!i&&!r;(e>0||i>0)&&(e<t&&!i&&!r&&this.timer("start"),n&&this.timer("finish"))}},{key:"timer",value:function(e){var t;if(this.states.timer[e]=Date.now(),"finish"==e)return t=this.states.timer.finish-this.states.timer.start,console.log(t),t}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.Utils=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"metersToPx",value:function(e){return 100*e/1}},{key:"kmHrToPxSec",value:function(e){return e*(.28*100)/1}}]),e}()},function(e,t,i){"use strict";var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i(3),s=i(2),a=i(1),o=i(0);var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.io_api=t,this.controls=null,this.wsocket=null,this.cfg={screen_width:window.document.body.scrollWidth,screen_height:window.document.body.scrollHeight,renderer:u.AUTO,element:"",players:{main:{car_sprite:"/assets/game/img/cars/phantom/car.png",max_gears:6,max_speed:n.Utils.kmHrToPxSec(150)},enemy:{car_sprite:"/assets/game/img/cars/phantom/car.png",max_gears:6,max_speed:n.Utils.kmHrToPxSec(150)}}},this.stage=new s.DragStrip({world:{width:n.Utils.metersToPx(402.34),height:512,background:"/assets/game/img/bg/dragstrip.png"}}),this.characters={player:new a.PlayerCar({position_x:0,name:(""+Date.now()).slice(9,13),gearbox:new o.Gearbox({max_gears:this.cfg.players.main.max_gears,shifting_delay:100}),max_speed:this.cfg.players.main.max_speed}),enemy:new a.PlayerCar({position_x:0,name:"",gearbox:new o.Gearbox({max_gears:this.cfg.players.enemy.max_gears,shifting_delay:100}),max_speed:this.cfg.players.enemy.max_speed})}}return r(e,[{key:"start",value:function(){return this.game=new u.Game(this.cfg.screen_width,this.cfg.screen_height,this.cfg.renderer,this.cfg.element,{preload:function(){this.game.load.image("stage__bg",this.stage.config.world.background),this.game.load.image("player__car",this.cfg.players.main.car_sprite),this.game.load.image("enemy__car",this.cfg.players.enemy.car_sprite)}.bind(this),create:function(){var e=this.stage.config.world;this.cfg.players.main,this.cfg.players.enemy,this.game.add.tileSprite(0,0,e.width,e.height,"stage__bg");this.controls=this.game.input.keyboard.createCursorKeys(),this.characters.player.sprite=this.game.add.sprite(0,377,"player__car"),this.characters.enemy.sprite=this.game.add.sprite(0,239,"enemy__car"),this.game.stage.backgroundColor="#dedede",this.game.time.advancedTiming=!0,this.game.stage.disableVisibilityChange=!0,this.game.world.setBounds(0,0,e.width,e.height),this.game.physics.arcade.enable(this.characters.player.sprite),this.game.physics.arcade.enable(this.characters.enemy.sprite),this.game.camera.follow(this.characters.player.sprite)}.bind(this),update:function(){this.characters.player.position_x=this.characters.player.sprite.body.x,this.stage.onUpdate(this.characters.player.position_x),this.characters.player.onUpdate(this.controls),this.characters.enemy.sprite.x=this.characters.enemy.position_x}.bind(this),render:function(){this.game.debug.cameraInfo(this.game.camera,32,32),this.game.debug.spriteCoords(this.characters.player.sprite,32,500),this.game.debug.text(this.game.time.fps||"--",2,14,"#00ff00"),this.game.debug.text("Players: "+[this.characters.player.name,this.characters.enemy.name].join(" "),2,120,"#00ff00"),this.game.debug.text(this.characters.player.gearbox.current_shift.name,this.cfg.screen_width-45,377,"#00ff00")}.bind(this)}),this}},{key:"connect",value:function(){return this.wsocket=this.io_api(void 0,{query:{uid:this.characters.player.name}}),this.wsocket.on("user.joined",function(e){this.room_name=e.room,e.id!=this.characters.player.name&&(this.characters.enemy.name=e.id)}.bind(this)),this.wsocket.on("user.update",function(e){e.u!=this.characters.player.name&&(this.characters.enemy.name=e.u,this.characters.enemy.position_x=e.x)}.bind(this)),this.wsocket.on("user.disconnected",function(){window.location.reload()}.bind(this)),this}},{key:"broadcastLoop",value:function(e){var t=1e3/60*e;return setInterval(function(){this.wsocket&&this.wsocket.emit("user.update",{x:this.characters.player.position_x,u:this.characters.player.name,room:this.room_name})}.bind(this),t),this}}]),e}(),h=window.io,u=window.Phaser;window.App=new c(h).connect().broadcastLoop().start()}]);